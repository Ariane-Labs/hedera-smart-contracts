---
status: "proposed"
date: "2025-10-07"
decision-makers: Fernano Paris <fernando.paris@swirldslabs.com>, Mariusz Jasuwienas <mariusz.jasuwienas@arianelabs.com>, Michal Walczak <michal.walczak@arianelabs.com>, Piotr Swierzy <piotr.swierzy@arianelabs.com>
consulted:
informed:
supersedes: ADR-001
---

# ADR 003: Directory Structure for System Contracts Repository

## Context and Problem Statement

The new Hedera System Contracts repository needs a consistent, readable, and scalable directory structure. The structure should make it easy for developers to find production contracts, interfaces, and their extensions while allowing for future growth.

We need to decide between a simplified flat structure versus a more granular modular split.

## Decision Drivers

- Ease of finding production contracts and interfaces
- Simplicity and reduced cognitive load for users
- Ability to grow (add new system services) without directory chaos
- Consistency with community practices (e.g., OpenZeppelin Contracts)
- Clear separation of concerns (contracts, interfaces, utilities, tests)
- Maintainability and scalability

## Considered Options

### Option 1: Simplified Structure (Recommended)

A flatter structure with fewer nested directories, making it easier to navigate and understand at a glance.

**Directory Layout:**

```
contracts/
├── account-service/
│   ├── HederaAccountService.sol
│   ├── IHederaAccountService.sol
│   ├── IHRC632.sol
│   ├── IHRC904AccountFacade.sol
│   ├── IHRC906.sol
│   └── IHRC906AccountFacade.sol
├── schedule-service/
│   ├── HederaScheduleService.sol
│   ├── IHederaScheduleService.sol
│   ├── IHRC755.sol
│   ├── IHRC755ScheduleFacade.sol
│   └── IHRC756.sol
├── token-service/
│   ├── HederaTokenService.sol
│   ├── IHederaTokenService.sol
│   ├── IHRC719.sol
│   ├── IHRC904TokenFacade.sol
│   ├── IHTSStructs.sol
│   ├── FeeHelper.sol
│   ├── KeyHelper.sol
│   ├── ExpiryHelper.sol
│   └── safe-hts/
├── token-service-v2/
│   ├── HederaTokenService.sol
│   ├── IHederaTokenServiceV2.sol
│   ├── FeeHelper.sol
│   ├── KeyHelper.sol
│   └── HederaResponseCodes.sol
├── prng/
│   ├── PrngSystemContract.sol
│   └── IPrngSystemContract.sol
├── hip-719-proxy/
│   └── HRC719TokenProxy.sol
├── common/
│   └── HederaResponseCodes.sol
└── mocks/
test/
```

**Pros:**
- Simple, flat structure - easy to navigate
- Less cognitive load for developers
- Faster to locate specific contracts
- Similar to OpenZeppelin's flat structure within modules
- Fewer directories to manage
- Clear service boundaries without excessive nesting

**Cons:**
- Interfaces and implementations are in the same directory
- Less separation between different types of files (interfaces, helpers, implementations)
- May become cluttered if services grow significantly
- Harder to identify file types at a glance

### Option 2: Modular, Granular Structure

A more hierarchical structure with dedicated subdirectories for interfaces, utilities, and other components.

**Directory Layout:**

```
contracts/
├── interfaces/              # Top-level facades
│   ├── IHRC904AccountFacade.sol
│   ├── IHRC906AccountFacade.sol
│   ├── IHRC755ScheduleFacade.sol
│   ├── IHRC904TokenFacade.sol
│   └── IPrngSystemContract.sol
├── account-service/
│   ├── HederaAccountService.sol
│   └── interfaces/
│       ├── IHederaAccountService.sol
│       ├── IHRC632.sol
│       └── IHRC906.sol
├── schedule-service/
│   ├── HederaScheduleService.sol
│   └── interfaces/
│       ├── IHederaScheduleService.sol
│       ├── IHRC755.sol
│       └── IHRC756.sol
├── token-service/
│   ├── HederaTokenService.sol
│   ├── interfaces/
│   │   ├── IHederaTokenService.sol
│   │   ├── IHRC719.sol
│   │   └── IHTSStructs.sol
│   └── utils/
│       ├── FeeHelper.sol
│       ├── KeyHelper.sol
│       ├── ExpiryHelper.sol
│       └── safe-hts/
├── token-service-v2/
│   ├── HederaTokenService.sol
│   ├── interfaces/
│   │   └── IHederaTokenServiceV2.sol
│   └── utils/
│       ├── FeeHelper.sol
│       ├── KeyHelper.sol
│       └── HederaResponseCodes.sol
├── prng/
│   └── PrngSystemContract.sol
├── hip-719-proxy/
│   └── HRC719TokenProxy.sol
├── common/
│   └── HederaResponseCodes.sol
└── mocks/
test/
```

**Pros:**
- Clear separation between interfaces, implementations, and utilities
- Easy to identify file types at a glance
- Better organization for large services with many files
- Service-specific utilities are isolated
- Clearer architecture and intent

**Cons:**
- More complex directory structure
- More directories to navigate
- Increased cognitive load
- May be over-engineered for the current scope
- Longer import paths
- More initial setup complexity

## Decision Outcome

**Chosen option:** Simplified structure (Option 1).

### Rationale

The simplified structure provides the best balance for the Hedera System Contracts library:

1. **Simplicity first**: Most services have a manageable number of files, making a flat structure within each service directory sufficient
2. **Developer experience**: Easier to navigate and understand, especially for new users
3. **OpenZeppelin alignment**: Similar to how OpenZeppelin organizes contracts within their modules
4. **Reduced overhead**: Fewer directories mean less navigation and shorter import paths
5. **Sufficient scalability**: Service-level directories provide clear boundaries without excessive nesting
6. **Pragmatic approach**: Can refactor to more granular structure later if specific services grow significantly

### Key Principles

- **Service-level organization**: Each system service (account-service, token-service, etc.) has its own directory
- **Flat within services**: Interfaces, implementations, and helpers coexist in the same service directory
- **Special directories**:
  - `common/` for shared utilities
  - `mocks/` for test mocks
  - `test/` for all tests and examples
- **Subdirectories allowed**: Services can have subdirectories (e.g., `safe-hts/`) when logically grouped functionality exists

## Consequences

### Positive

- Simple, intuitive structure
- Easy to find contracts quickly
- Lower barrier to entry for new developers
- Less cognitive overhead
- Shorter import paths
- Sufficient for current scope
- Can scale to more granular structure if needed

### Negative

- Less visual separation between interfaces and implementations
- May require discipline to prevent service directories from becoming too large
- Some duplication in naming (e.g., multiple files named FeeHelper.sol in different services)

## Implementation Notes

See detailed file mapping table in the appendix showing the migration path from the current repository structure to the new structure.

## Appendix: File Migration Mapping

### Hedera Account Service

| Current file                                                                   | New location                                                       |
| ------------------------------------------------------------------------------ | ------------------------------------------------------------------ |
| contracts/system-contracts/hedera-account-service/HederaAccountService.sol     | contracts/account-service/HederaAccountService.sol                 |
| contracts/system-contracts/hedera-account-service/IHederaAccountService.sol    | contracts/account-service/interfaces/IHederaAccountService.sol     |
| contracts/system-contracts/hedera-account-service/IHRC632.sol                  | contracts/account-service/interfaces/IHRC632.sol                   |
| contracts/system-contracts/hedera-account-service/IHRC904AccountFacade.sol     | contracts/interfaces/IHRC904AccountFacade.sol                      |
| contracts/system-contracts/hedera-account-service/IHRC906.sol                  | contracts/account-service/interfaces/IHRC906.sol                   |
| contracts/system-contracts/hedera-account-service/IHRC906AccountFacade.sol     | contracts/interfaces/IHRC906AccountFacade.sol                      |

### Hedera Schedule Service

| Current file                                                                     | New location                                                        |
| -------------------------------------------------------------------------------- | ------------------------------------------------------------------- |
| contracts/system-contracts/hedera-schedule-service/HederaScheduleService.sol     | contracts/schedule-service/HederaScheduleService.sol                |
| contracts/system-contracts/hedera-schedule-service/IHederaScheduleService.sol    | contracts/schedule-service/interfaces/IHederaScheduleService.sol    |
| contracts/system-contracts/hedera-schedule-service/IHRC755.sol                   | contracts/schedule-service/interfaces/IHRC755.sol                   |
| contracts/system-contracts/hedera-schedule-service/IHRC755ScheduleFacade.sol     | contracts/interfaces/IHRC755ScheduleFacade.sol                      |
| contracts/system-contracts/hedera-schedule-service/IHRC756.sol                   | contracts/schedule-service/interfaces/IHRC756.sol                   |

### Hedera Token Service

| Current file                                                               | New location                                                  |
| -------------------------------------------------------------------------- | ------------------------------------------------------------- |
| contracts/system-contracts/hedera-token-service/HederaTokenService.sol     | contracts/token-service/HederaTokenService.sol                |
| contracts/system-contracts/hedera-token-service/IHederaTokenService.sol    | contracts/token-service/interfaces/IHederaTokenService.sol    |
| contracts/system-contracts/hedera-token-service/IHRC719.sol                | contracts/token-service/interfaces/IHRC719.sol                |
| contracts/system-contracts/hedera-token-service/IHRC904TokenFacade.sol     | contracts/interfaces/IHRC904TokenFacade.sol                   |
| contracts/system-contracts/hedera-token-service/IHTSStructs.sol            | contracts/token-service/interfaces/IHTSStructs.sol            |
| contracts/system-contracts/hedera-token-service/FeeHelper.sol              | contracts/token-service/utils/FeeHelper.sol                   |
| contracts/system-contracts/hedera-token-service/KeyHelper.sol              | contracts/token-service/utils/KeyHelper.sol                   |
| contracts/system-contracts/hedera-token-service/ExpiryHelper.sol           | contracts/token-service/utils/ExpiryHelper.sol                |
| contracts/system-contracts/hedera-token-service/examples                   | test/                                                         |
| contracts/system-contracts/hedera-token-service/safe-hts                   | contracts/token-service/utils/safe-hts                        |
| contracts/hip-719-proxy/HRC719TokenProxy.sol                               | contracts/hip-719-proxy/HRC719TokenProxy.sol                  |

### Hedera Token Service v2

| Current file                                                                        | New location                                                        |
| ----------------------------------------------------------------------------------- | ------------------------------------------------------------------- |
| contracts/system-contracts/hedera-token-service-v2/HederaTokenService.sol           | contracts/token-service-v2/HederaTokenService.sol                  |
| contracts/system-contracts/hedera-token-service-v2/IHederaTokenService.sol          | contracts/token-service-v2/interfaces/IHederaTokenServiceV2.sol    |
| contracts/system-contracts/hedera-token-service-v2/FeeHelper.sol                    | contracts/token-service-v2/utils/FeeHelper.sol                     |
| contracts/system-contracts/hedera-token-service-v2/KeyHelper.sol                    | contracts/token-service-v2/utils/KeyHelper.sol                     |
| contracts/system-contracts/hedera-token-service-v2/HederaResponseCodes.sol          | contracts/token-service-v2/utils/HederaResponseCodes.sol           |
| contracts/system-contracts/hedera-token-service-v2/examples/HIP1028Contract.sol     | test/                                                              |

### Native Contracts

All native contract examples moved to test/

### Pseudo-Random Number Generator

| Current file                                                                          | New location                                    |
| ------------------------------------------------------------------------------------- | ----------------------------------------------- |
| contracts/system-contracts/pseudo-random-number-generator/IPrngSystemContract.sol     | contracts/interfaces/IPrngSystemContract.sol    |
| contracts/system-contracts/pseudo-random-number-generator/PrngSystemContract.sol      | contracts/prng/PrngSystemContract.sol           |

### General Utilities

| Current file                                         | New location                    |
| ---------------------------------------------------- | -------------------------------- |
| contracts/system-contracts/HederaResponseCodes.sol   | contracts/common/interfaces     |
